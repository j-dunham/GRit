#!/usr/bin/env ruby
# frozen_string_literal: true

require 'fileutils'
require_relative '../lib/grit/object'

if Dir.exist? GRit::GRIT_DIRECTORY
  warn 'Found existing GRit project'
  exit 1
end

def build_objects_directory
  %w[info pack].each do |path|
    FileUtils.mkdir_p(File.join(GRit::OBJECTS_DIRECTORY, path))
  end
end

def build_refs_directory
  %w[heads tags].each do |path|
    FileUtils.mkdir_p(File.join(GRit::REFS_DIRECTORY, path))
  end
end

def build_head
  File.open(File.join(GRit::GRIT_DIRECTORY, 'HEAD'), 'w') do |file|
    file.puts 'ref: refs/heads/main'
  end
end

def init
  Dir.mkdir GRit::GRIT_DIRECTORY
  build_objects_directory
  build_refs_directory
  build_head
  $stdout.puts 'GRit initialized!'
end

init
